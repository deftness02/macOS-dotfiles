#!/usr/bin/env bash

###############################################################################
# macOS Configuration Script                                                   #
###############################################################################
# This file is based largely upon the efforts of:
# ~/.macos — https://mths.be/macos
# See my repo readme for more credits:
# https://github.com/leftygamer02/macOS-dotfiles

# To begin, the System Preferences (pre-Ventura / Settings (post-Ventura) app 
# must be closed so as to prevent it from overwriting any changes to take
# place in this script.
osascript -e 'tell application "System Preferences" to quit'

# Now ask for an administrator/SU password
sudo -v

# For the duration of the .macos script's execution, the sudo session will be 
# maintained with checks every 60 seconds.
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

###############################################################################
## Set Opts                                                                  ##
###############################################################################
# TODO: Add descriptions of opts for context 

# This is the list of opts I'm presented with using macOS Ventura.
# Sources used include:
# - https://ss64.com/osx/set.html
# - https://zsh.sourceforge.io/Doc/Release/Options.html
# - 

# Opt Name            Default       Description
# noaliases             off         Expand aliases.
# aliasfuncdef          off         Allows the definition of functions, such as using 
#                                   the ‘name ()’ syntax if name was expanded as 
#                                   an alias.
# allexport             off         Mark variables which are modified or created 
#                                   for export.
# noalwayslastprompt    off         If unset, key functions that list completions try 
#                                   to return to the last prompt if given a numeric argument. 
#                                   If set these functions try to return to the last prompt if
#                                   given no numeric argument.
# alwaystoend           off         If a completion is performed with the cursor 
#                                   within a word, and a full completion is inserted, 
#                                   the cursor is moved to the end of the word.
# appendcreate          off         This option only applies when NO_CLOBBER (-C) is in effect. 
#                                   If this option is not set, the shell will report an error when
#                                   a append redirection (>>) is used on a file that does not already 
#                                   exists (the traditional zsh behaviour of NO_CLOBBER). If the option 
#                                   is set, no error is reported (POSIX behaviour). 
# noappendhistory       off         If this is set, zsh sessions will append their history list to the 
#                                   history file, rather than replace it. Thus, multiple parallel zsh 
#                                   sessions will all have the new entries from their history lists added 
#                                   to the history file, in the order that they exit. The file will still be 
#                                   periodically re-written to trim it when the number of lines grows 20% 
#                                   beyond the value specified by $SAVEHIST (see also the HIST_SAVE_BY_COPY 
#                                   option).
# autocd                off         If a command is issued that can’t be executed as a normal command, and 
#                                   the command is the name of a directory, perform the cd command to that 
#                                   directory. This option is only applicable if the option SHIN_STDIN is set, 
#                                   i.e. if commands are being read from standard input. The option is designed 
#                                   for interactive use; it is recommended that cd be used explicitly in scripts 
#                                   to avoid ambiguity.
# autocontinue          off         With this option set, stopped jobs that are removed from the job table with the 
#                                   disown builtin command are automatically sent a CONT signal to make them running.
# noautolist            off         Prevents list choices on an ambiguous completion. 
# noautomenu            off         Prevents use menu completion after the second consecutive request for completion, 
#                                   such as pressing the tab key repeatedly.
# autonamedirs          off         Any parameter that is set to the absolute name of a directory immediately becomes 
#                                   a name for that directory, that will be used by the ‘%~’ and related prompt sequences, 
#                                   and will be available when completion is performed on a word starting with ‘~’.
# noautoparamkeys       off         If a parameter name was completed and a following character (normally a space) 
#                                   automatically inserted, and the next character typed is one of those that have 
#                                   to come directly after the name (like ‘}’, ‘:’, etc.), the automatically added 
#                                   character is deleted, so that the character typed comes immediately after the parameter 
#                                   name. Completion in a brace expansion is affected similarly: the added character 
#                                   is a ‘,’, which will be removed if ‘}’ is typed next.
# noautoparamslash      off         If a parameter is completed whose content is the name of a directory, then add 
#                                   a trailing slash instead of a space.
# autopushd             off         Make cd push the old directory onto the directory stack.
# noautoremoveslash     off         When the last character resulting from a completion is a slash and the next character 
#                                   typed is a word delimiter, a slash, or a character that ends a command (such as a 
#                                   semicolon or an ampersand), remove the slash.
# autoresume            off         Treat single word simple commands without redirection as candidates for resumption 
#                                   of an existing job.
# nobadpattern          off         If a pattern for filename generation is badly formed, print an error message. 
#                                   (If this option is unset, the pattern will be left unchanged.) 
# nobanghist            off         Perform textual history expansion, csh-style, treating the character ‘!’ specially.
# nobareglobqual        off         In a glob pattern, treat a trailing set of parentheses as a qualifier list, if it 
#                                   contains no ‘|’, ‘(’ or (if special) ‘~’ characters.
# bashautolist          off         On an ambiguous completion, automatically list choices when the completion function 
#                                   is called twice in succession. This takes precedence over AUTO_LIST. The setting of 
#                                   LIST_AMBIGUOUS is respected. If AUTO_MENU is set, the menu behaviour will then start 
#                                   with the third press. Note that this will not work with MENU_COMPLETE, since repeated 
#                                   completion calls immediately cycle through the list in that case.
# bashrematch           off         When set, matches performed with the =~ operator will set the BASH_REMATCH array
#                                   variable, instead of the default MATCH and match variables. The first element of the 
#                                   BASH_REMATCH array will contain the entire matched text and subsequent elements will 
#                                   contain extracted substrings. This option makes more sense when KSH_ARRAYS is also set, 
#                                   so that the entire matched portion is stored at index 0 and the first substring is at 
#                                   index 1. Without this option, the MATCH variable contains the entire matched text and 
#                                   the match array variable contains substrings.
# nobeep                off         Prevents the device from audible beeps upon encountering an error.
# nobgnice              off         Run all background jobs at a lower priority. This option is set by default.
# braceccl              off         Expand expressions in braces which would not otherwise undergo brace expansion to a 
#                                   lexically ordered list of all the characters. See Brace Expansion.
# bsdecho               off         Make the echo builtin compatible with the BSD echo(1) command. This disables backslashed 
#                                   escape sequences in echo strings unless the -e option is specified.
# nocaseglob            off         Make globbing (filename generation) sensitive to case. Note that other uses of patterns 
#                                   are always sensitive to case. If the option is unset, the presence of any character 
#                                   which is special to filename generation will cause case-insensitive matching. For example, 
#                                   cvs(/) can match the directory CVS owing to the presence of the globbing flag (unless the 
#                                   option BARE_GLOB_QUAL is unset).
# nocasematch           off         Make regular expressions using the zsh/regex module (including matches with =~) sensitive 
#                                   to case.
# cbases                off         Output hexadecimal numbers in the standard C format, for example ‘0xFF’ instead of the 
#                                   usual ‘16#FF’. If the option OCTAL_ZEROES is also set (it is not by default), octal numbers 
#                                   will be treated similarly and hence appear as ‘077’ instead of ‘8#77’. This option has no 
#                                   effect on the choice of the output base, nor on the output of bases other than hexadecimal 
#                                   and octal. Note that these formats will be understood on input irrespective of the setting 
#                                   of C_BASES.
# cdablevars            off         If the argument to a cd command (or an implied cd with the AUTO_CD option set) is not a 
#                                   directory, and does not begin with a slash, try to expand the expression as if it were 
#                                   preceded by a ‘~’ (see Filename Expansion).
# cdsilent              off         Never print the working directory after a cd (whether explicit or implied with the AUTO_CD 
#                                   option set). cd normally prints the working directory when the argument given to it was -, 
#                                   a stack entry, or the name of a directory found under CDPATH. Note that this is distinct 
#                                   from pushd’s stack-printing behaviour, which is controlled by PUSHD_SILENT. This option 
#                                   overrides the printing-related effects of POSIX_CD.
# chasedots             off         When changing to a directory containing a path segment ‘..’ which would otherwise be treated 
#                                   as canceling the previous segment in the path (in other words, ‘foo/..’ would be removed from 
#                                   the path, or if ‘..’ is the first part of the path, the last part of the current working 
#                                   directory would be removed), instead resolve the path to the physical directory. This option 
#                                   is overridden by CHASE_LINKS.
# chaselinks            off         Resolve symbolic links to their true values when changing directory. This also has the effect 
#                                   of CHASE_DOTS, i.e. a ‘..’ path segment will be treated as referring to the physical parent, 
#                                   even if the preceding path segment is a symbolic link.
# nocheckjobs           off         Report the status of background and suspended jobs before exiting a shell with job control; 
#                                   a second attempt to exit the shell will succeed. NO_CHECK_JOBS is best used only in combination 
#                                   with NO_HUP, else such jobs will be killed automatically.
# nocheckrunningjobs    off         Check for both running and suspended jobs when CHECK_JOBS is enabled. When this option is 
#                                   disabled, zsh checks only for suspended jobs, which matches the default behavior of bash.
# noclobber             off         Prevent output redirection using `>', `>&',
#                                   and `<>' from overwriting existing files.
# combiningchars        on          Assume that the terminal displays combining characters correctly. Specifically, if a base 
#                                   alphanumeric character is followed by one or more zero-width punctuation characters, assume 
#                                   that the zero-width characters will be displayed as modifications to the base character within 
#                                   the same width.
# completealiases       off         Prevents aliases on the command line from being internally substituted before completion is 
#                                   attempted.
# completeinword        off         Assume that the terminal displays combining characters correctly. Specifically, if a base 
#                                   alphanumeric character is followed by one or more zero-width punctuation characters, assume 
#                                   that the zero-width characters will be displayed as modifications to the base character 
#                                   within the same width. Not all terminals handle this. If this option is not set, zero-width 
#                                   characters are displayed separately with special mark-up.
# continueonerror       off         If a fatal error is encountered (see Errors), and the code is running in a script, the shell 
#                                   will resume execution at the next statement in the script at the top level, in other words 
#                                   outside all functions or shell constructs such as loops and conditions.
# correct               off         Try to correct the spelling of commands. Note that, when the HASH_LIST_ALL option is not set 
#                                   or when some directories in the path are not readable, this may falsely report spelling errors 
#                                   the first time some commands are used.
# correctall            off       
# cprecedences          off       
# cshjunkiehistory      off       
# cshjunkieloops        off       
# cshjunkiequotes       off       
# cshnullcmd            off       
# cshnullglob           off       
# nodebugbeforecmd      off         Run the DEBUG trap before each command; otherwise it is run after each command. Setting this 
#                                   option mimics the behaviour of ksh 93; with the option unset the behaviour is that of ksh 88.
# dvorak                off       
# emacs                 off         
# noequals              off         Perform = filename expansion.
# errexit               off         Exit immediately if a simple command exits with a non-zero status, unless the command that fails 
#                                   is part of an until or  while loop, part of an if statement, part of a && or || list, or if the 
#                                   command's return status is being inverted using !.
# errreturn             off       
# noevallineno          off         If set, line numbers of expressions evaluated using the builtin eval are tracked separately of 
#                                   the enclosing environment. This applies both to the parameter LINENO and the line number output 
#                                   by the prompt escape %i. If the option is set, the prompt escape %N will output the string ‘(eval)’ 
#                                   instead of the script or function name as an indication. (The two prompt escapes are typically 
#                                   used in the parameter PS4 to be output when the option XTRACE is set.) If EVAL_LINENO is unset, 
#                                   the line number of the surrounding script or function is retained during the evaluation.
# noexec                off         Do execute commands. Without this option, commands are read and checked for syntax errors, but 
#                                   not executed. This option cannot be turned off in an interactive shell, except when ‘-n’ is 
#                                   supplied to the shell at startup.
# extendedglob          off       
# extendedhistory       off       
# noflowcontrol         off         If this option is unset, output flow control via start/stop characters (usually assigned to 
#                                   ^S/^Q) is disabled in the shell’s editor.
# forcefloat            off       
# nofunctionargzero     off         When executing a shell function or sourcing a script, set $0 temporarily to the name of the 
#                                   function/script. Note that toggling FUNCTION_ARGZERO from on to off (or off to on) does not 
#                                   change the current value of $0. Only the state upon entry to the function or script has an 
#                                   effect.
# noglob                off         Disable file name generation (globbing).
# noglobalexport        off         If this option is set, passing the -x flag to the builtins declare, float, integer, readonly 
#                                   and typeset (but not local) will also set the -g flag; hence parameters exported to the environment 
#                                   will not be made local to the enclosing function, unless they were already or the flag +g is given 
#                                   explicitly. If the option is unset, exported parameters will be made local in just the same way as 
#                                   any other parameter.
# noglobalrcs           off         If this option is unset, the startup files /etc/zprofile, /etc/zshrc, /etc/zlogin and /etc/zlogout 
#                                   will not be run. It can be disabled and re-enabled at any time, including inside local startup 
#                                   files (.zshrc, etc.).
# globassign            off         
# globcomplete          off         
# globdots              off         
# globstarshort         off       
# globsubst             off       
# nohashcmds            off         Locate and remember (hash) commands as they are looked up for execution. This option is enabled 
#                                   by default.
# nohashdirs            off         Whenever a command name is hashed, hash the directory containing it, as well as all directories 
#                                   that occur earlier in the path. Has no effect if neither HASH_CMDS nor CORRECT is set.
# hashexecutablesonly   off       
# nohashlistall         off         Whenever a command completion or spelling correction is attempted, make sure the entire command 
#                                   path is hashed first. This makes the first completion slower but avoids false reports of spelling 
#                                   errors.
# histallowclobber      off       
# nohistbeep            off         Beep in ZLE when a widget attempts to access a history entry which isn’t there.
# histexpiredupsfirst   off        
# histfcntllock         off       
# histfindnodups        off        
# histignorealldups     off       
# histignoredups        off       
# histignorespace       off       
# histlexwords          off       
# histnofunctions       off       
# histnostore           off       
# histreduceblanks      off       
# nohistsavebycopy      off         When the history file is re-written, we normally write out a copy of the file named 
#                                   $HISTFILE.new and then rename it over the old one. However, if this option is unset, we instead 
#                                   truncate the old history file and write out the new version in-place. If one of the history-appending 
#                                   options is enabled, this option only has an effect when the enlarged history file needs to be re-written 
#                                   to trim it down to size. Disable this only if you have special needs, as doing so makes it possible to 
#                                   lose history entries if zsh gets interrupted during the save.
# histsavenodups        off       
# histsubstpattern      off       
# histverify            off       
# nohup                 off         Send the HUP signal to running jobs when the shell exits.
# ignorebraces          off       
# ignoreclosebraces     off         The shell will perform brace expansion if activated.
# ignoreeof             off       
# incappendhistory      off       
# incappendhistorytime  off       
# interactive           on        
# interactivecomments   off       
# ksharrays             off       
# kshautoload           off       
# kshglob               off       
# kshoptionprint        off       
# kshtypeset            off       
# kshzerosubscript      off       
# nolistambiguous       off         This option works when AUTO_LIST or BASH_AUTO_LIST is also set. If there is an unambiguous prefix to 
#                                   insert on the command line, that is done without a completion list being displayed; in other words, 
#                                   auto-listing behaviour only takes place when nothing would be inserted. In the case of BASH_AUTO_LIST, 
#                                   this means that the list will be delayed to the third call of the function.
# nolistbeep            off         Beep on an ambiguous completion. More accurately, this forces the completion widgets to return status 
#                                   1 on an ambiguous completion, which causes the shell to beep if the option BEEP is also set; this may 
#                                   be modified if completion is called from a user-defined widget.
# listpacked            off       
# listrowsfirst         off         
# nolisttypes           off         When listing files that are possible completions, show the type of each file with a trailing 
#                                   identifying mark.
# localloops            off       
# localoptions          off       
# localpatterns         off       
# localtraps            off       
# login                 on        
# longlistjobs          off       
# magicequalsubst       off       
# mailwarning           off       
# markdirs              off       
# menucomplete          off       
# monitor               on        
# nomultibyte           off         Respect multibyte characters when found in strings. When this option is set, strings are examined 
#                                   using the system library to determine how many bytes form a character, depending on the current 
#                                   locale. This affects the way characters are counted in pattern matching, parameter values and 
#                                   various delimiters.
# nomultifuncdef        off         Allow definitions of multiple functions at once in the form ‘fn1 fn2...()’; if the option is not 
#                                   set, this causes a parse error. Definition of multiple functions with the function keyword is always 
#                                   allowed. Multiple function definitions are not often used and can cause obscure errors.
# nomultios             off         Perform implicit tees or cats when multiple redirections are attempted (see Redirection).
# nonomatch             off         If a pattern for filename generation has no matches, print an error, instead of leaving it unchanged 
#                                   in the argument list. This also applies to file expansion of an initial ‘~’ or ‘=’. 
# nonotify              off         Cause the status of terminated background jobs to be 
#                                   reported immediately, rather than before printing the
#                                   next primary prompt.
# nullglob              off         If a pattern for filename generation has no matches, delete the pattern from the argument list instead 
#                                   of reporting an error. Overrides NOMATCH.
# numericglobsort       off         If numeric filenames are matched by a filename generation pattern, sort the filenames numerically 
#                                   rather than lexicographically.
# octalzeroes           off       
# overstrike            off         Defaults the editor to "insert" mode. This replaces 
#                                   the character to the right with each keystroke.
# pathdirs              off       
# pathscript            off       
# pipefail              off       
# posixaliases          off       
# posixargzero          off       
# posixbuiltins         off       
# posixcd               off       
# posixidentifiers       off        
# posixjobs             off       
# posixstrings          off       
# posixtraps            off       
# printeightbit         off       
# printexitvalue        off       
# privileged            off       
# promptbang            off       
# nopromptcr            off         Print a carriage return just before printing a prompt in the line editor. This is on by default 
#                                   as multi-line editing is only possible if the editor knows where the start of the line appears.
# nopromptpercent       off         If set, ‘%’ is treated specially in prompt expansion.
# nopromptsp            off         Attempt to preserve a partial line (i.e. a line that did not end with a newline) that would otherwise 
#                                   be covered up by the command prompt due to the PROMPT_CR option. This works by outputting some 
#                                   cursor-control characters, including a series of spaces, that should make the terminal wrap to the 
#                                   next line when a partial line is present (note that this is only successful if your terminal has 
#                                   automatic margins, which is typical).
# promptsubst           off       
# pushdignoredups       off       
# pushdminus            off       
# pushdsilent           off       
# pushdtohome           off       
# rcexpandparam         off       
# rcquotes              off       
# norcs                 off         After /etc/zshenv is sourced on startup, source the .zshenv, /etc/zprofile, .zprofile, /etc/zshrc, 
#                                   .zshrc, /etc/zlogin, .zlogin, and .zlogout files, as described in Files. If this option is unset, 
#                                   the /etc/zshenv file is still sourced, but any of the others will not be; it can be set at any time 
#                                   to prevent the remaining startup files after the currently executing one from being sourced.
# recexact              off       
# rematchpcre           off       
# restricted            off       
# rmstarsilent          off       
# rmstarwait            off       
# sharehistory          off         This option both imports new commands from the history file, and also causes your typed commands 
#                                   to be appended to the history file (the latter is like specifying INC_APPEND_HISTORY, which should 
#                                   be turned off if this option is in effect). The history lines are also output with timestamps ala 
#                                   EXTENDED_HISTORY (which makes it easier to find the spot where we left off reading the file after 
#                                   it gets re-written).
# shfileexpansion        off        Perform filename expansion (e.g., ~ expansion) before parameter expansion, command substitution, 
#                                   arithmetic expansion and brace expansion. If this option is unset, it is performed after brace expansion, 
#                                   so things like ‘~$USERNAME’ and ‘~{pfalstad,rc}’ will work.
# shglob                off         Disables the special meaning of ‘(’, ‘|’, ‘)’ and ’<’ for globbing the result of parameter and command 
#                                   substitutions, and in some other places where the shell accepts patterns. If SH_GLOB is set but KSH_GLOB 
#                                   is not, the shell allows the interpretation of subshell expressions enclosed in parentheses in some cases 
#                                   where there is no space before the opening parenthesis, e.g. !(true) is interpreted as if there were a 
#                                   space after the !. This option is set by default if zsh is invoked as sh or ksh. 
# shinstdin             on          Commands are being read from the standard input. Commands are read from standard input if no command 
#                                   is specified with -c and no file of commands is specified. If SHIN_STDIN is set explicitly on the command 
#                                   line, any argument that would otherwise have been taken as a file to run will instead be treated as a 
#                                   normal positional parameter.
# shnullcmd             off         Do not use the values of NULLCMD and READNULLCMD when doing redirections, use ‘:’ instead.
# shoptionletters       off         If this option is set the shell tries to interpret single letter options (which are used with set and 
#                                   setopt) like ksh does. This also affects the value of the - special parameter.
# noshortloops          off         Allow the short forms of for, repeat, select, if, and function constructs.
# shwordsplit           off         Causes field splitting to be performed on unquoted parameter expansions.
# singlecommand         off         If the shell is reading from standard input, it exits after a single command has been executed. This 
#                                   also makes the shell non-interactive, unless the INTERACTIVE option is explicitly set on the command 
#                                   line.
# singlelinezle         off         When activated, this prevents multi-line editing.
# sourcetrace           off         If set, zsh will print an informational message announcing the name of each file it loads. The format 
#                                   of the output is similar to that for the XTRACE option, with the message <sourcetrace>. A file may be 
#                                   loaded by the shell itself when it starts up and shuts down (Startup/Shutdown Files) or by the use of 
#                                   the ‘source’ and ‘dot’ builtin commands.
# sunkeyboardhack       off         If a line ends with a backquote, and there are an odd number of backquotes on the line, ignore the 
#                                   trailing backquote.
# transientrprompt      off         Remove any right prompt from display when accepting a command line. This may be useful with terminals 
#                                   with other cut/paste methods.
# trapsasync            off         While waiting for a program to exit, handle signals and run traps immediately. Otherwise the trap is 
#                                   run after a child process has exited.
# typesetsilent         off         If this is unset, executing any of the ‘typeset’ family of commands with no options and a list of 
#                                   parameters that have no values to be assigned but already exist will display the value of the parameter.
# nounset               off         Treat unset parameters as if they were empty when substituting, and as if they were zero when reading 
#                                   their values in arithmetic expansion and arithmetic commands. Otherwise they are treated as an error.
# verbose               off         Print shell input lines as they are read.
# vi                    off         If ZLE is loaded, turning on this option has the equivalent effect of ‘bindkey -v’. In addition, the 
#                                   EMACS option is unset. Turning it off has no effect.
# warncreateglobal      off         Print a warning message when a global parameter is created in a function by an assignment or in math 
#                                   context. This often indicates that a parameter has not been declared local when it should have been.
# warnnestedvar         off         Print a warning message when an existing parameter from an enclosing function scope, or global, is 
#                                   set in a function by an assignment or in math context.
# xtrace                off         Print commands and their arguments as they are executed.
# zle                   on          Use the zsh line editor. Set by default in interactive shells connected to a terminal. 

# Turn off some options
optOff=(
    noaliases
    nobanghist
    nobgnice
    nocaseglob
    nocasematch
    cdsilent
    combiningchars
    completealiases
    continueonerror
    correct
)
echo "Turning off some opts..."
set +o "${optOff[@]}"

# Turn on some options
optOn=(
    noappendhistory
    nobadpattern
    nobeep
    cbases
    chaselinks
)
echo "Turning on some opts..."
set -o "${optOn[@]}"

# allexport            off
# braceexpand          on
# emacs                on
# errexit              off
# errtrace             off
# functrace            off
# hashall              on
# histexpand           on
# history              on
# ignoreeof            off
# interactive-comments on
# keyword              off
# monitor              on
# noclobber            off
# noexec               off
# noglob               off
# nolog                off
# notify               off
# nounset              off
# onecmd               off
# physical             off
# pipefail             off
# posix                off
# privileged           off
# verbose              off
# vi                   off
# xtrace               off
      

# Turn off some options
optOff=(
    
)
echo "Turning off opts..."
set +o "${optOff[@]}"


# Here are the opts if you're using bash
# Opt                 Default     Description
# cdable_vars    	        off     
# cdspell        	        off     
# checkhash      	        off       
# checkwinsize   	        off       
# cmdhist        	        on        
# compat31       	        off       
# dotglob        	        off       
# execfail       	        off       
# expand_aliases 	        on        
# extdebug       	        off       
# extglob        	        off
# extquote       	        on
# failglob       	        off
# force_fignore  	        on
# gnu_errfmt     	        off
# histappend     	        off
# histreedit     	        off
# histverify     	        off
# hostcomplete   	        on
# huponexit      	        off
# interactive_comments	  on
# lithist        	        off
# login_shell    	        off
# mailwarn       	        off
# no_empty_cmd_completion	off
# nocaseglob     	        off
# nocasematch    	        off
# nullglob       	        off
# progcomp       	        on
# promptvars     	        on
# restricted_shell	      off
# shift_verbose  	        off
# sourcepath     	        on
# xpg_echo       	        off

# Turn off some options
shoptOff=(
    history
    noaliases
    extendedhistory
    noglob
    nohashcmds
    nohashdirs
    login
    privileged
    sharehistory
    sunkeyboardhack
    zle
)
echo "Turning off opts..."
set +o "${shoptOff[@]}"

# Turn on some options
shoptOn=(
    errexit
    nounset
    pipefail
    nobeep
    noexec
    histnostore
    ignoreeof
    localoptions
    markdirs
    nonotify
    norcs
    sourcetrace
    trapsasync
    xtrace
)
echo "Turning on opts..."
set -o "${shoptOn[@]}"

(shopt -p inherit_errexit &>/dev/null) && shopt -s inherit_errexit


###############################################################################
## General UI/UX                                                             ##
###############################################################################

# Turn off all audio when the system is booting.
nvram SystemAudioVolume=" "
nvram StartupMute=%01

# Disable transparency in the menu bar and elsewhere in macOS.
defaults write com.apple.universalaccess reduceTransparency -bool true

# Set the highlight color to green.
defaults write -g AppleHighlightColor -string "0.764700 0.976500 0.568600"

# Increase the speed of dialog boxes resizing.
defaults write -g NSWindowResizeTime -float 0.001

# Set the default sidebar icon size to medium.
defaults write -g NSTableViewDefaultSizeMode -int 2

# Disable resuming any previously-opened apps system-wide.
defaults write com.apple.systempreferences NSQuitAlwaysKeepsWindows -bool false

# Disable automatic termination of inactive apps.
defaults write -g NSDisableAutomaticTermination -bool true

# Always show scrollbars to get rid of animation and such.
# Possible values: `WhenScrolling`, `Automatic` and `Always`
defaults write -g AppleShowScrollBars -string "Always"

# Disable the over-the-top focus ring animation.
defaults write -g NSUseAnimatedFocusRing -bool false

# Reveal IP address, hostname, OS version, etc. when clicking the clock
# from the login window.
sudo defaults write /Library/Preferences/com.apple.loginwindow AdminHostInfo HostName

# Disable Notification Center and remove the menu bar icon.
launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist 2> /dev/null

# Disable automatic capitalization as it’s annoying when typing code.
defaults write -g NSAutomaticCapitalizationEnabled -bool false

# Disable smart dashes as they’re annoying when typing code.
defaults write -g NSAutomaticDashSubstitutionEnabled -bool false

# Disable automatic period substitution as it’s annoying when typing code.
defaults write -g NSAutomaticPeriodSubstitutionEnabled -bool false

# Disable smart quotes as they’re annoying when typing code.
defaults write -g NSAutomaticQuoteSubstitutionEnabled -bool false

# Disable auto-correct because it's really annoying when typing code.
defaults write -g NSAutomaticSpellingCorrectionEnabled -bool false

# Disable automatic spell checking for reduced resource usage.
defaults write -g NSAllowContinuousSpellChecking -bool false

# Disable smooth scrolling. This is done to reduce animations and save computer
# resources for more important stuff.
defaults write -g NSScrollAnimationEnabled -bool false # Default is true
defaults write -g AppleScrollAnimationEnabled -bool false # Default is true

# Remove all window animation effects when opening/closing windows to speed
# things up a little.
defaults write -g NSAutomaticWindowAnimationsEnabled -bool false # Default is true
defaults write -g DisablePasswordManagerAnimations -bool true # Default is false

# To further speed things up, remove the animations for Quick Look windows.
defaults write -g QLPanelAnimationDuration -float 0

# While iCloud is great and all, let's disable it as a default location when
# saving new files.
defaults write -g NSDocumentSaveNewDocumentsToCloud -bool false # Default is true

# Don't show the Open panel when launching apps like TextEdit or Preview if opened
# without a target file already selected.
defaults write -g NSShowAppCentricOpenPanelInsteadOfUntitledFile -bool false

# Automatically expand the Save panel by default.
defaults write -g NSNavPanelExpandedStateForSaveMode -bool true
defaults write -g NSNavPanelExpandedStateForSaveMode2 -bool true

# Expand the Save dialog window by default for convenience.
defaults write -g NSNavPanelExpandedStateForSaveMode -bool true

# Increase tracking speed beyond the maximum allowable value you can select in
# the System Preferences / Settings app (which is 3.0).
defaults write -g com.apple.mouse.scaling -float 5.0

# Stop the cursor/caret from blinking.
defaults write -g NSTextInsertionPointBlinkPeriodOff -float 0
defaults write -g NSTextInsertionPointBlinkPeriodOn -float 999999999999

# Don't treat period or colon as part of a word when parsing.
# The value `en_US_POSIX` corresponds to the "United States (Computer)" setting 
# that was shown in System Preferences in 10.8 and earlier.
defaults write -g AppleTextBreakLocale en_US_POSIX

# Display ASCII control characters in caret notation.
defaults write -g NSTextShowsControlCharacters -bool true

# Add a context menu item for showing the web inspector to web views.
defaults write -g WebKitDeveloperExtras -bool true

# Increase the speed of scrolling by dragging.
defaults write -g NSAutoscrollResponseMultiplier -float 3

# Don't include shadows in screenshots of windows
defaults write com.apple.screencapture disable-shadow -bool true

# Omit crash report dialogs.
defaults write com.apple.CrashReporter DialogType none

# Don't show a warning when opening files downloaded from the internet.
# This does not disable warnings shown when opening an application for the first time.
defaults write com.apple.LaunchServices LSQuarantine -bool false

# Don't verify disk images and don't run fsck on quarantined disk images.
defaults write com.apple.frameworks.diskimages skip-verify -bool true
defaults write com.apple.frameworks.diskimages auto-fsck -bool true

# Don't save .DS_Store files on network volumes.
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true

###############################################################################
## Accessibility Settings                                                    ##
###############################################################################

defaults write com.apple.Accessibility EnhancedBackgroundContrastEnabled -bool true
defaults write com.apple.Accessibility FullKeyboardAccessFocusRingEnabled -bool false
defaults write com.apple.Accessibility ReduceMotionEnabled -bool true
defaults write com.apple.Accessibility FullKeyboardAccessEnabled -bool false
defaults write com.apple.Accessibility DarkenSystemColors -bool true

###############################################################################
## Bluetooth                                                                 ##
###############################################################################

sudo defaults write /Library/Preferences/com.apple.Bluetooth ControllerPowerState -int 0 && \
sudo killall -HUP bluetoothd

# Uncomment to enable Bluetooth again.
# sudo defaults write /Library/Preferences/com.apple.Bluetooth ControllerPowerState -int 1

###############################################################################
## Bonjour                                                                 ##
###############################################################################

# Disable the Bonjour service.
defaults write /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist ProgramArguments -array-add "-NoMulticastAdvertisements"
dscacheutil -flushcache && \
killall -HUP mDNSResponder

###############################################################################
## Dock, Dashboard, and Hot Corners                                          ##
###############################################################################

defaults write com.apple.dock launchanim -bool false
defaults write com.apple.dock show-recents -bool false
defaults write com.apple.dock autohide -bool false
defaults write com.apple.dock magnification -bool false
defaults write com.apple.dock mineffect -string "scale"
defaults write com.apple.dock minimize-to-application -bool true
defaults write com.apple.dock tilesize -int 50
defaults write com.apple.dock wvous-br-corner -int 0

###############################################################################
## Finder                                                                    ##
###############################################################################

defaults write com.apple.finder NewWindowTarget -string "PfLo"
defaults write com.apple.finder NewWindowTargetPath -string "file://${HOME}"

# Don't open a Finder window when extracting an archive.
defaults write com.apple.archiveutility dearchive-reveal-after -bool false

# Don't open a Finder window when mounting a volume.
defaults write com.apple.finder OpenWindowForNewRemovableDisk -bool false

# Allow quitting the app via ⌘ + Q; doing so will also hide desktop icons.
defaults write com.apple.finder QuitMenuItem -bool true

defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -bool false
defaults write com.apple.finder ShowHardDrivesOnDesktop -bool false
defaults write com.apple.finder ShowRemovableMediaOnDesktop -bool false
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false
defaults write com.apple.finder FXEnableRemoveFromICloudDriveWarning -bool false
defaults write com.apple.finder FXRemoveOldTrashItems -bool true
defaults write com.apple.finder WarnOnEmptyTrash -bool false
defaults write com.apple.finder _FXSortFoldersFirst -bool true
defaults write com.apple.finder FXPreferredViewStyle -string "clmv"
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false
defaults write com.apple.finder FXArrangeGroupViewBy -string "Kind"
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

defaults write com.apple.finder AppleShowAllFiles -bool true
defaults write -g AppleShowAllExtensions -bool true
defaults write com.apple.finder ShowPathbar -bool true
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true
chflags nohidden ~/Library && xattr -d com.apple.FinderInfo ~/Library
chflags nohidden /Volumes
defaults write com.apple.finder QuitMenuItem -bool true
defaults write -g NSScrollViewRubberbanding -bool false
defaults write com.apple.finder CreateDesktop -bool false


###############################################################################
## Firewall                                                                  ##
###############################################################################

# This turns on the macOS Firewall.
/usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on

# This is an added security measure as it gets your talkative computer to stop
# chatting with all the devices that may wander nearby or on the same network.
/usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on

# Turn this on to block all incoming web traffic. This effectively gives you
# control over when your apps communicate outward, plus it's a good security
# step to take.
/usr/libexec/ApplicationFirewall/socketfilterfw --setblockall

# Turn on logging if you want to track connections taking place.
/usr/libexec/ApplicationFirewall/socketfilterfw --setloggingmode on

# This turns off the ability for signed apps to bypass the Firewall.
# I do this so that I can customize which apps I actually want connected
# to the internet, versus curbing the overly-chatty system apps I 
# never use and can't remove.
/usr/libexec/ApplicationFirewall/socketfilterfw --setallowsigned off

# Block internet access to the following apps because they're annoying.
allowApps=(
    /Applications/AdBlock.app
    /Applications/App\ Store.app
    /Applications/Apple\ Configurator.app
    /Applications/Bitwarden.app
    /Applications/Cakebrew.app
    /Applications/Calendar.app
    /Applications/Clock.app
    /Applications/CloudMounter.app
    /Applications/Contacts.app
    /Applications/CrossOver.app
    /Applications/DataGrip.app
    /Applications/Day\ One.app
    /Applications/Dictionary.app
    /Applications/Discord.app
    /Applications/Firefox.app
    /Applications/GitHub\ Desktop.app
    /Applications/iMazing\ Profile\ Editor.app
    /Applications/iMazing.app
    /Applications/IntelliJ\ IDEA.app
    /Applications/Jump\ Desktop.app
    /Applications/LastPass.app
    /Applications/Lulu.app
    /Applications/Mail.app
    /Applications/Parallels\ Desktop.app
    /Applications/Photos.app
    /Applications/Postman.app
    /Applications/Proton\ Mail\ Bridge.app
    /Applications/ProtonVPN.app
    /Applications/PyCharm\ Edu.app
    /Applications/Rider.app
    /Applications/Safari.app
    /Applications/Sequel\ Ace.app
    /Applications/Shortcuts.app
    /Applications/Spotify.app
    /Applications/System\ Settings.app
)
echo "Giving internet access to apps..."
/usr/libexec/ApplicationFirewall/socketfilterfw --add "${allowApps[@]}"

# Block internet access to the following apps because they're annoying.
blockApps=(
    /Applications/AppLocker.app
    /Applications/Books.app
    /Applications/Calculator.app
    /Applications/Chess.app
    /Applications/Font\ Book.app
    /Applications/Home.app
    /Applications/Image\ Capture.app
    /Applications/Launchpad.app
    /Applications/MacroRecorder.app
    /Applications/Maps.app
    /Applications/Messages.app
    /Applications/Mission\ Control.app
    /Applications/Music.app
    /Applications/News.app
    /Applications/Photo\ Booth.app
    /Applications/Podcasts.app
    /Applications/Preview.app
    /Applications/QuickTime\ Player.app
    /Applications/Siri.app
    /Applications/Stocks.app
    /Applications/TextEdit.app
    /Applications/Time\ Machine.app
    /Applications/TV.app
    /Applications/Voice\ Memos.app
)
echo "Blocking internet access to apps..."
/usr/libexec/ApplicationFirewall/socketfilterfw --blockapp "${blockApps[@]}"

###############################################################################
## Infrared Receiver                                                         ##
###############################################################################

defaults write /Library/Preferences/com.apple.driver.AppleIRController DeviceEnabled -int 0

# Uncomment below to enable
# defaults write /Library/Preferences/com.apple.driver.AppleIRController DeviceEnabled -int 1

###############################################################################
## Power Saving Settings                                                     ##
###############################################################################

pmset -a lidwake 1
pmset -a sms 0

# Restart automatically on power loss
pmset -a autorestart 1
pmset -a standby 0
pmset -a powernap 0
pmset -a disksleep 0
pmset -a sleep 0
pmset -a ttyskeepawake 0
pmset -a displaysleep 0
pmset -a tcpkeepalive 0
pmset -a lowpowermode 0
pmset -a womp 0

systemsetup -setrestartfreeze on
systemsetup -setcomputersleep Off > /dev/null

rm -rf /private/var/vm/sleepimage
touch /private/var/vm/sleepimage
chflags uchg /private/var/vm/sleepimage

###############################################################################
## Remote Access                                                             ##
###############################################################################

# Disable remote login.
launchctl unload -w /System/Library/LaunchDaemons/ssh.plist

# Disable the ARD Agent and Remove Access Privileges for All Users.
/System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -deactivate -configure -access -off


# Get rid of Apple Remote Desktop settings
sudo rm -rf /var/db/RemoteManagement ; \
sudo defaults delete /Library/Preferences/com.apple.RemoteDesktop.plist ; \
defaults delete ~/Library/Preferences/com.apple.RemoteDesktop.plist ; \
sudo rm -r /Library/Application\ Support/Apple/Remote\ Desktop/ ; \
rm -r ~/Library/Application\ Support/Remote\ Desktop/ ; \
rm -r ~/Library/Containers/com.apple.RemoteDesktop


# Disable TFTP
launchctl unload -F /System/Library/LaunchDaemons/tftp.plist
launchctl stop com.apple.tftpd

###############################################################################
## Safari                                                                    ##
###############################################################################

# Change the default fonts in Safari
defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2StandardFontFamily Georgia
defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2DefaultFontSize 16
defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2FixedFontFamily Menlo
defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2DefaultFixedFontSize 14

# Activate the Develop menu and Web Inspector
defaults write com.apple.Safari IncludeInternalDebugMenu -bool true
defaults write com.apple.Safari IncludeDevelopMenu -bool true
defaults write com.apple.Safari WebKitDeveloperExtrasEnabledPreferenceKey -bool true
defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2DeveloperExtrasEnabled -bool true
defaults write -g WebKitDeveloperExtras -bool true

###############################################################################
## Screencaptures                                                            ##
###############################################################################

defaults write com.apple.screencapture location -string "${HOME}/medien"

defaults write com.apple.screencapture type -string "png"

###############################################################################
## TextEdit                                                                  ##
###############################################################################

# Create an untitled document when launching
defaults write com.apple.TextEdit NSShowAppCentricOpenPanelInsteadOfUntitledFile -bool false

# Turn off rich text mode.
defaults write com.apple.TextEdit RichText -int 0

###############################################################################
## Trackpad, Mouse, Keyboard, Bluetooth Accessories, and Input               ##
###############################################################################

# Changes targeting the following domains:
# - com.apple.driver.AppleBluetoothMultitouch.trackpad
# - 

# Int or bool?
# defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadRightClick -int 1
# defaults write com.apple.driver.AppleBluetoothMultitouch.trackpage TrackpadRotate -int 0
# defaults write com.apple.driver.AppleBluetoothMultitouch.trackpage Clicking -bool false

# Increase sound quality for Bluetooth headphones/headsets.
defaults write com.apple.BluetoothAudioAgent "Apple Bitpool Min (editable)" -int 40

# Enable the press-and-hold behavior to access additional characters.
defaults write -g ApplePressAndHoldEnabled -bool true

###############################################################################
## Kill Affected Applications                                                ##
###############################################################################

for app in "Activity Monitor" \
	"Address Book" \
	"Calendar" \
	"cfprefsd" \
	"Contacts" \
	"CrossOver" \
	"DataGrip" \
	"Dock" \
	"FaceTime" \
	"Finder" \
	"Firefox" \
	"Mail" \
	"Maps" \
	"Messages" \
	"Music" \
	"Photos" \
	"Podcasts" \
	"Rider" \
	"Safari" \
	"Stocks" \
	"SystemUIServer" \
	"Terminal" \
	"TextEdit" \
	"Transmission" \
	"iCal"; do
	killall "${app}" &> /dev/null
done
echo "Configuration completed. Some of these changes will require a logout/restart to take effect."